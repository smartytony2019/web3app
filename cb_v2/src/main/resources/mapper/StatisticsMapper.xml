<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xinbo.chainblock.mapper.StatisticsMapper">


    <!-- 插入或更新 -->
    <insert id="insertOrUpdate" parameterType="com.xinbo.chainblock.entity.StatisticsEntity">
        insert into t_statistics(`date`, uid, username, bet_money, bet_profit_money, bet_payout_money, recharge_money,
                                 withdraw_money, update_time)
        values (#{entity.date}, #{entity.uid}, #{entity.username}, #{entity.betMoney}, #{entity.betProfitMoney},
                #{entity.betPayoutMoney}, #{entity.rechargeMoney}, #{entity.withdrawMoney},
                #{entity.updateTime}) ON DUPLICATE KEY
        UPDATE
            bet_money = bet_money + VALUES (bet_money),
            bet_profit_money = bet_profit_money + VALUES (bet_profit_money),
            bet_payout_money = bet_payout_money + VALUES (bet_payout_money),
            recharge_money = recharge_money + VALUES (recharge_money),
            withdraw_money = recharge_money + VALUES (withdraw_money),
            update_time = VALUES (update_time)
    </insert>


    <!-- 插入或更新 -->
    <insert id="batchInsert" parameterType="java.util.List">
        insert into t_statistics(
        `date`, uid, username, bet_amount, profit_amount,
        recharge_trc20_amount, recharge_trx_amount, withdraw_trc20_amount, withdraw_trx_amount, update_time
        ) values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.date}, #{item.uid}, #{item.username}, #{item.betAmount}, #{item.profitAmount},
            #{item.rechargeTrc20Amount}, #{item.rechargeTrxAmount},
            #{item.withdrawTrc20Amount},#{item.withdrawTrxAmount}, #{item.updateTime})
        </foreach>
        ON DUPLICATE KEY UPDATE
        bet_amount = bet_amount + VALUES (bet_amount),
        profit_amount = profit_amount + VALUES (profit_amount),
        recharge_trc20_amount = recharge_trc20_amount + VALUES (recharge_trc20_amount),
        recharge_trx_amount = recharge_trx_amount + VALUES (recharge_trx_amount),
        withdraw_trc20_amount = withdraw_trc20_amount + VALUES (withdraw_trc20_amount),
        withdraw_trx_amount = withdraw_trx_amount + VALUES (withdraw_trx_amount),
        update_time = VALUES (update_time)
    </insert>


    <select id="findByUidStr" resultType="com.xinbo.chainblock.entity.StatisticsEntity">
        select * from t_statistics where `date` = #{date} and uid in (
        <foreach collection="childList" item="item" separator="," index="">
            #{item}
        </foreach>
        )
    </select>


    <select id="findByUid" resultType="com.xinbo.chainblock.entity.StatisticsEntity">
        select *
        from t_statistics
        where `date` = #{date}
          and uid = #{childUid}
    </select>


</mapper>